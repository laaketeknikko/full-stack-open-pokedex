name: Deployment pipeline

on:
   push:
      branches:
         - master
   pull_request:
      branches: [master]
      types: [opened, synchronize]

jobs:
   simple_deployment_pipeline:
      runs-on: ubuntu-20.04
      steps:
         - uses: actions/checkout@v3
         - uses: actions/setup-node@v3
           with:
              node-version: "16"
         - name: Install dependencies
           run: npm install
         - name: Lint
           run: npm run eslint
         - name: Build
           run: npm run build
         - name: Run tests
           run: npm run test
         - name: End-to-End tests
           uses: cypress-io/github-action@v5
           with:
              command: npm run test:e2e
              start: npm run start-prod
              wait-on: http://localhost:5000

         #- name: Bump version and push tag
         #  uses: anothrNick/github-tag-action@1.67.0
         #  env:
         #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

         - name: Deploy to render.com
           # From Render documentation: deploy only if branch is master
           if: github.ref == 'refs/heads/master'
           env:
              deploy_url: ${{secrets.RENDER_DEPLOY_HOOK_URL}}
           run: curl "$deploy_url"
